---
- name: Containerhost tasks
  tags: [container]
  block:
    - name: Podman setup tasks
      ansible.builtin.import_tasks: podman.yml
      when: containerhost_podman_enabled
      tags: [podman]

    - name: Podman-docker setup tasks
      ansible.builtin.import_tasks: podman-docker.yml
      when: containerhost_podman_enabled
      tags: [podman]

    - name: Toolbox container setup tasks
      ansible.builtin.import_tasks: toolbox-container.yml
      tags: [toolbox-container]

- name: Container services tasks
  tags: [container, container-service]
  block:
    - name: Ensure directory prefixes for container services
      when: containerhost_services
      ansible.builtin.file:
        dest: "{{ item }}"
        state: "directory"
        owner: "root"
        mode: "0755"
      with_items:
        - "{{ containerhost_etc_path }}"
        - "{{ containerhost_var_path }}"

    - name: Install container services
      ansible.builtin.include_tasks:
        file: container-service.yml
      with_dict: "{{ containerhost_services }}"
      loop_control:
        loop_var: container_service_item
