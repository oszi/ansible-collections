---
- name: Ensure EPEL is installed on RedHat except Fedora
  when: "ansible_facts.distribution != 'Fedora'"
  ansible.builtin.dnf:
    name: "epel-release"
    state: "present"

- name: Install RPMFusion repositories
  ansible.builtin.command:
    argv: ["dnf", "--assumeyes", "install", "{{ rpmfusion_url }}"]
  args:
    creates: "/etc/yum.repos.d/rpmfusion-{{ item }}.repo"
  vars:
    rpmfusion_url: "https://mirrors.rpmfusion.org/{{ item }}/{{
      (ansible_facts.distribution == 'Fedora') | ternary('fedora', 'el')
      }}/rpmfusion-{{ item }}-release-{{
      ansible_facts.distribution_major_version }}.noarch.rpm"
  with_items: ["free", "nonfree"]
