---
argument_specs:
  main:
    short_description: Kubernetes-spec services with podman-kube@.service
    description:
      - Manages Kubernetes-spec services using the podman-kube@.service systemd template
      - Provides lifecycle hooks for initialization and post-installation scripts
      - Alternative to quadlets when quadlets are unavailable or undesirable
      - Supports rootless mode with systemd user scope (requires lingering)
    author:
      - "David O. (oszi.dev)"
    options:
      podman_kube_list:
        description: List of Kubernetes specs for podman-kube@.service
        type: list
        elements: dict
        required: false
        options:
          path:
            description: Relative path to `podman_kube_base_path`, or an absolute path
            type: path
            required: true
          state:
            description:
              - Whether the service should be present, present_disabled, or absent
              - If present_disabled, the service is installed, including files and init_script, but not started
              - If absent, the service and all role-managed files will be irrevocably removed
            type: str
            required: false
            choices: [absent, present_disabled, present]
            default: present
          spec:
            description:
              - Dictionary or YAML string containing Kubernetes Pods, Deployments, DaemonSets, Jobs, and PersistentVolumeClaims
              - WARNING - Jinja templated numbers and booleans in a spec dictionary are strings in the final output of to_nice_yaml
              - Use YAML string documents to template port numbers, user and group IDs, complex structures, etc
              - Multiple YAML string documents (e.g., PodSpec + ConfigMap) are separated by ---
              - Required unless state=absent
            type: raw
            required: false
          files:
            description: Copy files or directories before installation
            type: list
            elements: dict
            required: false
            options:
              content:
                description: When used instead of `src`, sets the contents of a file directly to the specified value
                type: str
                required: false
              dest:
                description:
                  - Remote absolute path where the file or directory should be copied to
                  - Trailing slash behavior is similar to that of rsync
                type: path
                required: true
              directory_mode:
                description:
                  - Set the access permissions of newly created directories to the given mode
                  - Permissions on existing directories do not change, including parents of `src`
                type: raw
                required: false
              follow:
                description: This flag indicates that filesystem links in the destination, if they exist, should be followed
                type: bool
                required: false
                default: false
              force:
                description:
                  - Influence whether the remote file must always be replaced
                  - If true, the remote file will be replaced when contents are different from the source
                  - If false, the file will only be transferred if the destination does not exist
                type: bool
                required: false
                default: true
              group:
                description: Name or GID of the group that should own the filesystem object, as would be fed to `chown`
                type: raw
                required: false
              mode:
                description: Permissions of the destination file or directory, as would be fed to `chmod`
                type: raw
                required: false
              owner:
                description: Name or UID of the user that should own the filesystem object, as would be fed to `chown`
                type: raw
                required: false
              remote_src:
                description: Influence whether `src` needs to be transferred or already is present remotely
                type: bool
                required: false
                default: false
              src:
                description:
                  - Local path to a file or directory to copy to the remote server, absolute or relative
                  - Trailing slash behavior is similar to that of rsync
                type: path
                required: false
              validate:
                description:
                  - Validation command to run before copying the updated file into the final destination
                  - A temporary file path is used to validate, passed in through `%s` which must be present
                type: str
                required: false
          init_script:
            description:
              - Script run once before installation with bash -euo pipefail
              - Use for first-time setup tasks like volume creation or initial configuration
            type: str
            required: false
          post_install_script:
            description:
              - Script run after the service has changed with bash -euo pipefail
              - Use for post-install setup tasks that depend on the service being active
            type: str
            required: false
          uninstall_script:
            description:
              - Script run after the service is uninstalled with bash -euo pipefail
              - Use for cleanup with state=absent
            type: str
            required: false

      podman_kube_base_path:
        description:
          - Base path to install Kubernetes spec files to
          - Overridable with absolute paths in podman_kube_list[].path
          - Default is /etc/containers/kube, or ~/.config/containers/kube for rootless mode
        type: path
        required: false
