---
argument_specs:
  main:
    short_description: Shell environment configuration for Linux
    description:
      - Configures system-wide shell environment for Bash, ZSH and POSIX shells
      - Manages aliases, completions, prompts, history, environment variables, PATH and more
      - Installs essential shell tools and utilities
      - Enforces skeleton files for consistent user shell environments
    author:
      - "David O. (oszi.dev)"
    options:
      shell_disabled:
        description:
          - Whether to skip all shell configuration tasks
          - Useful for read-only systems or immutable environments
        type: bool
        required: false
        default: false

      shell_histsize:
        description:
          - Number of commands to keep in shell history per session in memory
        type: int
        required: false

      shell_histfilesize:
        description:
          - Number of commands to keep in shell history on disk
        type: int
        required: false

      shell_environment:
        description:
          - Dictionary of environment variables to set system-wide
          - If EDITOR or VISUAL is vi, ZSH switches to vi key-bindings
        type: dict
        required: false

      shell_search_paths:
        description:
          - List of additional paths to add to $PATH in .profile
          - Paths should be escaped for shells (e.g., '"$HOME"/.local/bin')
        type: list
        elements: str
        required: false

      shell_skeleton_enforced_users:
        description:
          - List of usernames to enforce role-managed `skel` files for
          - Ensures consistent shell configuration for all specified users
          - Defaults to users_list + ansible_user + root
        type: list
        elements: str
        required: false

      shell_packages:
        description:
          - Nested list of shell and essential utility packages to install
          - Includes bash, zsh, bash-completion, and common CLI tools
          - Set to empty list on immutable systems
        type: list
        elements: raw
        required: false

      shell_etc_path:
        description:
          - Path where `shrc` entrypoint, `shrc.d` and `skel` are installed
          - Override if /etc is not writeable (e.g., /usr/local/etc)
        type: path
        required: false

      shell_local_bin_path:
        description:
          - Directory path where shell scripts and local binaries are installed
          - Defaults to `local_bin_path` if set (should be in system PATH)
        type: path
        required: false

      shell_bash_completions_for_zsh:
        description:
          - List of ZSH-compatible bash-completion files to pre-load when native completion does not exist
          - Most bash-completion files are not ZSH-compatible, use selectively
        type: list
        elements: dict
        required: false
        options:
          command:
            description: Command to load completions for if `_command` does not exist
            type: str
            required: true
          path:
            description: Path to a ZSH-compatible bash-completion file
            type: path
            required: true
