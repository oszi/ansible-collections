---
- name: "Ensure ~/.gnupg exists for user:{{ dotfiles_user_item }}"
  ansible.builtin.file:
    path: "{{ dotfiles_user_info.home }}/.gnupg"
    owner: "{{ dotfiles_user_info.uid }}"
    group: "{{ dotfiles_user_info.group }}"
    mode: "0700"
    state: "directory"
  register: _dotfiles_gnupg_directory

- name: "Install gnupg dotfiles for user:{{ dotfiles_user_item }}"
  ansible.builtin.template:
    src: "{{ item }}"
    dest: "{{ _dotfiles_gnupg_directory.path }}/{{ item | basename | regex_replace('\\.j2$', '') }}"
    owner: "{{ dotfiles_user_info.uid }}"
    group: "{{ dotfiles_user_info.group }}"
    mode: "0600"
  with_fileglob:
    - "templates/dotfiles/gnupg/*.j2"
