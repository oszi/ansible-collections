---
argument_specs:
  main:
    short_description: Role for SSH connection bootstrap and fact gathering
    description:
      - Automatic fact gathering should be turned off in playbooks using this role
      - Performs initial SSH connection bootstrap with optional port fallback
      - Gathers system facts with configurable subset filtering
      - Validates system requirements with assertions
      - Updates the default package manager cache if necessary
    author:
      - "David O. (oszi.dev)"
    options:
      bootstrap_ssh_port_fallback:
        description:
          - Fallback SSH port to try if ansible_port is unreachable
          - Set to zero (or ansible_port) to disable SSH port fallback
          - Should be used with persistent fact caching disabled initially
        type: int
        required: false
        default: 22

      bootstrap_facts_gather_subset:
        description:
          - List of fact subsets to gather with M(ansible.builtin.setup)
          - Controls which system information is collected during bootstrapping
        type: list
        elements: str
        required: false
        default: ["all"]

      bootstrap_assert_that:
        description:
          - List of assertion rules for M(ansible.builtin.assert) to validate system requirements
          - Should contain literal strings without interpolation
        type: list
        elements: str
        required: false

      bootstrap_package_update_cache:
        description:
          - Whether to update the default package manager cache after fact gathering (not in rootless mode)
          - Enabled for apt to avoid having to specify cache_valid_time in package tasks
        type: bool
        required: false

      bootstrap_apt_cache_valid_time:
        description:
          - Cache validity time in seconds for apt (defaults to 24h)
        type: int
        required: false
