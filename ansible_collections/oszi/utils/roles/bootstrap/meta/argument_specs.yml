---
argument_specs:
  main:
    short_description: Role for connection bootstrapping
    description:
      - Performs initial SSH connection bootstrap with optional port fallback
      - Automatic fact gathering should be turned off in playbooks using this role
      - Updates the default package manager's cache if configured as such
    author:
      - "David O. (oszi.dev)"
    options:
      bootstrap_ssh_port_fallback: &bootstrap_ssh_port_fallback
        description:
          - Fallback SSH port to try if ansible_port is unreachable
          - Set to zero (or ansible_port) to disable SSH port fallback
          - Should be run with persistent fact caching disabled at first-time setup
        type: int
        required: false
        default: 22

      bootstrap_package_update_cache:
        description:
          - Whether to update the package manager's cache after bootstrapping
          - Useful for Debian/Ubuntu hosts that are often offline and fail to update apt cache
          - Enable manually for apt hosts, facts are not available at this point
          - Requires root privileges and also setting O(bootstrap_apt_cache_valid_time)
        type: bool
        required: false

      bootstrap_apt_cache_valid_time:
        description:
          - Cache validity time in seconds for apt (e.g., 86400 = 1 day)
          - Set manually for apt hosts, facts are not available at this point
        type: int
        required: false

  bootstrap:
    short_description: Direct entrypoint for bootstrap
    description:
      - Does not include double inclusion check so it always runs, even with persistent fact caching
      - Does not include updating the package manager's cache
      - Does not apply `always` or any other tag, unlike entrypoint `main`
    options:
      bootstrap_ssh_port_fallback:
        <<: *bootstrap_ssh_port_fallback
