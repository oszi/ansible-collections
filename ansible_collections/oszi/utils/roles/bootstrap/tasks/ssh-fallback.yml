---
- name: Check the configured SSH port
  ansible.builtin.wait_for:
    host: "{{ ansible_host | default(inventory_hostname) }}"
    port: "{{ bootstrap_ssh_port }}"
    connect_timeout: 3
    timeout: 9
    state: "started"
  become: false
  connection: local
  check_mode: false
  ignore_errors: true  # noqa: ignore-errors
  register: _bootstrap_wait_for_ssh_result

- name: Fallback to the default SSH port otherwise
  when: _bootstrap_wait_for_ssh_result is undefined or _bootstrap_wait_for_ssh_result.state is undefined
  ansible.builtin.set_fact:
    ansible_port: "{{ bootstrap_ssh_port_fallback }}"  # noqa: var-naming[no-role-prefix]
